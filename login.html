<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Kopi Prima</title>
    <link rel="stylesheet" href="css/style.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-color: #8b4513;
        --secondary-color: #d2691e;
        --accent-color: #a0522d;
        --dark-brown: #654321;
        --light-brown: #deb887;
        --text-dark: #333333;
        --text-light: #666666;
        --background-light: #f5f5f5;
        --white: #ffffff;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #8b4513, #d2691e);
        min-height: 100vh;
        overflow-x: hidden;
      }

      .login-container {
        display: flex;
        min-height: 100vh;
        position: relative;
      }

      .form-section {
        flex: 1;
        background: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        position: relative;
        z-index: 2;
      }

      .form-container {
        width: 100%;
        max-width: 400px;
      }

      .logo {
        text-align: center;
        margin-bottom: 2rem;
      }

      .logo i {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }

      .logo h1 {
        font-size: 2rem;
        color: var(--primary-color);
        font-weight: 700;
      }

      .form-title {
        text-align: center;
        margin-bottom: 0.5rem;
      }

      .form-title h2 {
        font-size: 1.8rem;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
      }

      .form-title p {
        color: var(--text-light);
        font-size: 1rem;
      }

      .form {
        margin-top: 2rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--text-dark);
        font-size: 0.9rem;
      }

      .form-group input {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      .form-group input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
      }

      .btn {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        color: var(--white);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
      }

      .form-links {
        text-align: center;
        margin-top: 1.5rem;
      }

      .form-links p {
        color: var(--text-light);
        margin-bottom: 1rem;
      }

      .form-links a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 600;
        transition: color 0.3s ease;
      }

      .form-links a:hover {
        color: var(--dark-brown);
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
        margin-top: 1rem;
      }

      .back-link:hover {
        color: var(--dark-brown);
      }

      .image-section {
        flex: 1;
        background: linear-gradient(
          135deg,
          var(--dark-brown),
          var(--primary-color)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        position: relative;
        overflow: hidden;
        transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }

      .image-content {
        text-align: center;
        color: var(--white);
        z-index: 2;
        position: relative;
      }

      .image-content h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        font-weight: 700;
      }

      .image-content p {
        font-size: 1.1rem;
        opacity: 0.9;
        line-height: 1.6;
      }

      .coffee-image {
        max-width: 300px;
        margin: 2rem auto;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      .coffee-image img {
        width: 100%;
        height: auto;
        display: block;
      }

      .image-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="rgba(255,255,255,0.05)"><circle cx="50" cy="50" r="2"/></svg>')
          repeat;
        animation: float 20s infinite linear;
      }

      @keyframes float {
        0% {
          transform: translateY(0px) rotate(0deg);
        }
        100% {
          transform: translateY(-100px) rotate(360deg);
        }
      }

      .loading,
      .error-message,
      .success-message {
        text-align: center;
        padding: 12px;
        border-radius: 8px;
        margin: 1rem 0;
        display: none;
      }

      .loading {
        color: var(--primary-color);
      }

      .error-message {
        background: #fee;
        color: #c33;
        border: 1px solid #fcc;
      }

      .success-message {
        background: #efe;
        color: #363;
        border: 1px solid #cfc;
      }

      .login-container.register-active .form-section {
        transform: translateX(100%);
      }

      .login-container.register-active .image-section {
        transform: translateX(-100%);
      }

      @media (max-width: 768px) {
        .login-container {
          flex-direction: column;
        }

        .form-section,
        .image-section {
          flex: none;
          min-height: 50vh;
        }

        .image-content h2 {
          font-size: 2rem;
        }

        .coffee-image {
          max-width: 200px;
        }

        .login-container.register-active .form-section,
        .login-container.register-active .image-section {
          transform: translateX(0) translateY(-100%);
        }
      }

      .form-switch {
        position: absolute;
        top: 2rem;
        right: 2rem;
        z-index: 3;
      }

      .switch-text {
        color: var(--white);
        font-weight: 500;
        cursor: pointer;
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .switch-text:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      #registerForm {
        display: none;
      }

      .login-container.register-active #loginForm {
        display: none;
      }

      .login-container.register-active #registerForm {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="login-container" id="loginContainer">
      <div class="form-section">
        <div class="form-container">
          <!-- Login Form -->
          <form id="loginForm" class="form">
            <div class="logo">
              <i class="fas fa-coffee"></i>
              <h1>KOPI PRIMA</h1>
            </div>

            <div class="form-title">
              <h2>Login Customer</h2>
              <p>Masuk ke akun Kopi Prima Anda</p>
            </div>

            <div class="form-group">
              <label for="loginUsername">Username</label>
              <input
                type="text"
                id="loginUsername"
                name="username"
                placeholder="Masukkan username"
                required
              />
            </div>

            <div class="form-group">
              <label for="loginPassword">Password</label>
              <input
                type="password"
                id="loginPassword"
                name="password"
                placeholder="Masukkan password"
                required
              />
            </div>

            <button type="submit" class="btn btn-primary">
              <i class="fas fa-sign-in-alt"></i>
              Login
            </button>

            <div class="form-links">
              <p>
                Belum punya akun?
                <a href="#" id="showRegister">Daftar di sini</a>
              </p>
              <a href="index.html" class="back-link">
                <i class="fas fa-arrow-left"></i>
                Kembali ke Beranda
              </a>
            </div>
          </form>

          <!-- Register Form -->
          <form id="registerForm" class="form">
            <div class="logo">
              <i class="fas fa-coffee"></i>
              <h1>KOPI PRIMA</h1>
            </div>

            <div class="form-title">
              <h2>Daftar Akun Baru</h2>
              <p>Bergabung dengan komunitas Kopi Prima</p>
            </div>

            <div class="form-group">
              <label for="regUsername">Username</label>
              <input
                type="text"
                id="regUsername"
                name="username"
                placeholder="Pilih username"
                required
              />
            </div>

            <div class="form-group">
              <label for="regEmail">Email</label>
              <input
                type="email"
                id="regEmail"
                name="email"
                placeholder="Masukkan email"
                required
              />
            </div>

            <div class="form-group">
              <label for="regPhone">Nomor Telepon</label>
              <input
                type="tel"
                id="regPhone"
                name="phone"
                placeholder="Contoh: 08123456789"
                required
              />
            </div>

            <div class="form-group">
              <label for="regPassword">Password</label>
              <input
                type="password"
                id="regPassword"
                name="password"
                placeholder="Buat password"
                required
              />
            </div>

            <div class="form-group">
              <label for="regConfirmPassword">Konfirmasi Password</label>
              <input
                type="password"
                id="regConfirmPassword"
                name="confirmPassword"
                placeholder="Ulangi password"
                required
              />
            </div>

            <button type="submit" class="btn btn-primary">
              <i class="fas fa-user-plus"></i>
              Daftar
            </button>

            <div class="form-links">
              <p>
                Sudah punya akun?
                <a href="#" id="showLogin">Login di sini</a>
              </p>
              <a href="index.html" class="back-link">
                <i class="fas fa-arrow-left"></i>
                Kembali ke Beranda
              </a>
            </div>
          </form>

          <div id="loading" class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Memproses...</p>
          </div>

          <div id="errorMessage" class="error-message"></div>
          <div id="successMessage" class="success-message"></div>
        </div>
      </div>

      <!-- Image Section -->
      <div class="image-section">
        <div class="form-switch">
          <div class="switch-text" id="switchForm">
            <i class="fas fa-sync-alt"></i>
            Switch to Register
          </div>
        </div>

        <div class="image-content">
          <h2>Selamat Datang</h2>
          <p>
            Nikmati pengalaman terbaik dengan kopi berkualitas premium dari
            perkebunan terbaik Indonesia
          </p>

          <div class="coffee-image">
            <img
              src="https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80"
              alt="Coffee Art"
            />
          </div>

          <p>
            Dengan lebih dari 35 tahun pengalaman, kami berkomitmen memberikan
            yang terbaik untuk Anda
          </p>
        </div>
      </div>
    </div>

    <script>
      // ===== FORM SWITCHING =====
      const loginContainer = document.getElementById("loginContainer");
      const showRegister = document.getElementById("showRegister");
      const showLogin = document.getElementById("showLogin");
      const switchForm = document.getElementById("switchForm");

      showRegister.addEventListener("click", function (e) {
        e.preventDefault();
        loginContainer.classList.add("register-active");
        switchForm.innerHTML =
          '<i class="fas fa-sync-alt"></i> Switch to Login';
      });

      showLogin.addEventListener("click", function (e) {
        e.preventDefault();
        loginContainer.classList.remove("register-active");
        switchForm.innerHTML =
          '<i class="fas fa-sync-alt"></i> Switch to Register';
      });

      switchForm.addEventListener("click", function () {
        loginContainer.classList.toggle("register-active");
        if (loginContainer.classList.contains("register-active")) {
          switchForm.innerHTML =
            '<i class="fas fa-sync-alt"></i> Switch to Login';
        } else {
          switchForm.innerHTML =
            '<i class="fas fa-sync-alt"></i> Switch to Register';
        }
      });

      // ===== MYSQL AUTH SYSTEM =====
      class MySQLAuthSystem {
        async register(userData) {
          try {
            const response = await fetch("http://localhost:5000/api/register", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(userData),
            });

            return await response.json();
          } catch (error) {
            console.error("Register API error:", error);
            return {
              success: false,
              message: "Koneksi ke server gagal!",
            };
          }
        }

        async login(username, password) {
          try {
            const response = await fetch("http://localhost:5000/api/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ username, password }),
            });

            return await response.json();
          } catch (error) {
            console.error("Login API error:", error);
            return {
              success: false,
              message: "Koneksi ke server gagal!",
            };
          }
        }
      }

      const auth = new MySQLAuthSystem();

      // ===== LOGIN FORM HANDLER =====
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const username = document
            .getElementById("loginUsername")
            .value.trim();
          const password = document
            .getElementById("loginPassword")
            .value.trim();
          const loading = document.getElementById("loading");
          const errorMessage = document.getElementById("errorMessage");
          const successMessage = document.getElementById("successMessage");

          errorMessage.style.display = "none";
          successMessage.style.display = "none";
          loading.style.display = "block";

          if (!username || !password) {
            loading.style.display = "none";
            errorMessage.textContent = "Username dan password harus diisi!";
            errorMessage.style.display = "block";
            return;
          }

          try {
            console.log("Attempting login for user:", username);

            const result = await auth.login(username, password);

            loading.style.display = "none";

            if (result.success) {
              successMessage.textContent = result.message;
              successMessage.style.display = "block";

              localStorage.setItem("currentUser", JSON.stringify(result.user));
              localStorage.setItem("isLoggedIn", "true");
              localStorage.setItem("userName", result.user.username);

              setTimeout(() => {
                window.location.href = "index.html";
              }, 1500);
            } else {
              errorMessage.textContent = result.message;
              errorMessage.style.display = "block";
            }
          } catch (error) {
            loading.style.display = "none";
            errorMessage.textContent = "Terjadi kesalahan: " + error.message;
            errorMessage.style.display = "block";
            console.error("Login error:", error);
          }
        });

      // ===== REGISTER FORM HANDLER =====
      document
        .getElementById("registerForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const username = document.getElementById("regUsername").value.trim();
          const email = document.getElementById("regEmail").value.trim();
          const phone = document.getElementById("regPhone").value.trim();
          const password = document.getElementById("regPassword").value;
          const confirmPassword =
            document.getElementById("regConfirmPassword").value;

          const loading = document.getElementById("loading");
          const errorMessage = document.getElementById("errorMessage");
          const successMessage = document.getElementById("successMessage");

          errorMessage.style.display = "none";
          successMessage.style.display = "none";
          loading.style.display = "block";

          if (!username || !email || !phone || !password || !confirmPassword) {
            loading.style.display = "none";
            errorMessage.textContent = "Semua field harus diisi!";
            errorMessage.style.display = "block";
            return;
          }

          if (username.length < 3) {
            loading.style.display = "none";
            errorMessage.textContent = "Username minimal 3 karakter!";
            errorMessage.style.display = "block";
            return;
          }

          if (password.length < 6) {
            loading.style.display = "none";
            errorMessage.textContent = "Password minimal 6 karakter!";
            errorMessage.style.display = "block";
            return;
          }

          if (password !== confirmPassword) {
            loading.style.display = "none";
            errorMessage.textContent = "Konfirmasi password tidak cocok!";
            errorMessage.style.display = "block";
            return;
          }

          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(email)) {
            loading.style.display = "none";
            errorMessage.textContent = "Format email tidak valid!";
            errorMessage.style.display = "block";
            return;
          }

          try {
            console.log("Attempting register for user:", username);

            const result = await auth.register({
              username,
              password,
              email,
              phone,
            });

            loading.style.display = "none";

            // Accept both our older `success` boolean and the backend `status: 'success'`
            const ok =
              result &&
              (result.success === true || result.status === "success");

            if (ok) {
              // Show green success message
              successMessage.textContent =
                result.message || "User created successfully";
              successMessage.style.display = "block";

              document.getElementById("registerForm").reset();

              setTimeout(() => {
                loginContainer.classList.remove("register-active");
                switchForm.innerHTML =
                  '<i class="fas fa-sync-alt"></i> Switch to Register';
                successMessage.style.display = "none";
              }, 2000);
            } else {
              errorMessage.textContent = result.message || "Register failed";
              errorMessage.style.display = "block";
            }
          } catch (error) {
            loading.style.display = "none";
            errorMessage.textContent = "Terjadi kesalahan: " + error.message;
            errorMessage.style.display = "block";
            console.error("Register error:", error);
          }
        });

      console.log("Login page loaded - MySQL Version");
    </script>
  </body>
</html>
